<mat-sidenav-container class="dkim">
    <mat-sidenav mode="side" open="true"></mat-sidenav>
    <mat-sidenav-content>
            <section class="mat-typography">
                <mat-card class='dkim'>
                    <mat-card-header style="display: flex; width: 100%">
                        <mat-card-title style="flex-grow: 1">
                            <h1 class="mat-h1">DKIM Signing</h1>
                            <p>
                                DKIM (DomainKeys Identified Mail) is an email authentication method that places a digital signature (a piece of code) in the headers of your outgoing mail that helps receiving email servers identify if the message was genuinely sent by you, the domain owner. The DKIM signature also confirms that certain aspects of the message have been unchanged since the digital signature was added.
                            </p>
                            <p>
                                You can read more about DKIM here: <a href="https://en.wikipedia.org/wiki/DomainKeys_Identified_Mail">https://en.wikipedia.org/wiki/DomainKeys_Identified_Mail</a>
                            </p>
                            <p>
                                If you have your domain hosted/registered via Runbox your DNS (Domain Name System) records are also probably managed by us. This makes it very easy to set up DKIM signing as you just need to activate it below.
                            </p>
                            <p>
                                If your domain is not hosted/registered via Runbox then we probably don't host your DNS records and you will need to make some changes at your domain host/DNS host as shown below.
                            </p>
                        </mat-card-title>
                    </mat-card-header>
                    <mat-divider></mat-divider>
                    <mat-accordion *ngIf="keys.length" [multi]="true">
                      <mat-expansion-panel *ngFor="let item of keys; let i = index" expanded="true">
                        <mat-expansion-panel-header>
                            <mat-panel-title>
                                <strong>DKIM Key#{{i}} </strong> {{item.selector_recordset_name}}
                            </mat-panel-title>
                          <mat-panel-description>
                              <span>{{get_status(item)}} {{item.date_expected_to_activate ? ' - will become active on ' + item.date_expected_to_activate : ''}}</span>
                          </mat-panel-description>
                        </mat-expansion-panel-header>

                        <mat-grid-list cols="2" rowHeight="30px" style='max-width: 800px'>

                            <mat-grid-tile style='background: lightblue;'>Hostname</mat-grid-tile>
                            <mat-grid-tile style='text-align: left'>{{item.selector_recordset_name}}</mat-grid-tile>

                            <mat-grid-tile style='background: lightblue;' *ngIf="item.public_recordset_name">Address</mat-grid-tile>
                            <mat-grid-tile style='text-align: left' *ngIf="item.public_recordset_name">{{item.public_recordset_name}}</mat-grid-tile>

                            <mat-grid-tile style='background: lightblue;'>CNAME Correct?</mat-grid-tile>
                            <mat-grid-tile style='text-align: left'>{{item.is_cname_correct ? 'yes' : 'no'}}</mat-grid-tile>

                            <mat-grid-tile style='background: lightblue;'>Key Active?</mat-grid-tile>
                            <mat-grid-tile style='text-align: left'>{{item.is_active ? 'yes' : 'no'}}</mat-grid-tile>

                            <mat-grid-tile style='background: lightblue;' *ngIf="is_rotating && !item.active">Key rotating?</mat-grid-tile>
                            <mat-grid-tile style='align-self: left' *ngIf="is_rotating && !item.active">Yes</mat-grid-tile>

                            <mat-grid-tile style='background: lightblue;' *ngIf="!item.is_cname_correct && item.cname_check_result">
                                Lastest cname check result
                            </mat-grid-tile>
                            <mat-grid-tile style='align-self: left' *ngIf="!item.is_cname_correct && item.cname_check_result">
                                {{item.cname_check_result}}
                            </mat-grid-tile>

                            <mat-grid-tile style='background: lightblue;' *ngIf="!item.is_cname_correct && item.cname_check_result">
                                Lastest cname <strong>expected</strong> result
                            </mat-grid-tile>
                            <mat-grid-tile style='align-self: left' *ngIf="!item.is_cname_correct && item.cname_check_result">
                                {{item.cname_check_expected}}
                            </mat-grid-tile>

                        </mat-grid-list>

                        <h2>Tips to manually configure the DKIM keys:</h2>
                        <pre>
Use the following to configure manually in your DNS

{{item.selector_recordset_name}} 3600 IN CNAME {{item.public_recordset_name}}

To check the cnames, you can use dig with this example:

dig -t CNAME selector1._domainkey.usefulphysics.uk.

and the expected response would be:

;; ANSWER SECTION:
{{item.selector_recordset_name}} 3600 IN CNAME {{item.public_recordset_name}}

                        </pre>

                        <div *ngIf="item.is_cname_hosted_by_runbox && !item.is_cname_correct">
                            <button mat-raised-button color="primary" (click)="reconfigure(item)">Reconfigure</button>
                            <button mat-raised-button color="primary" (click)="check_cname(item)">Check cname</button>
                        </div>
                        <span >* It might take some minutes for the system to be able to check recent changes.</span>
                        <span *ngIf="is_rotating && !item.active">
                            This key is under rotation state. This means it has been published however this key is not in use yet. Rotation has initialized on {{item.date_rotation_initiated}} and is expected to take 7 days to become active.
                        </span>

                      </mat-expansion-panel>

                    </mat-accordion>
                    <mat-divider></mat-divider>
                    <div *ngIf="!keys.length && !is_creating_keys">
                        No keys found for {{domain}}
                        <button mat-raised-button color="primary" (click)="create_keys()">Create keys for {{domain}}</button>
                    </div>
                    <mat-progress-bar mode="indeterminate" *ngIf="is_creating_keys"></mat-progress-bar>
                </mat-card>
            </section>
    </mat-sidenav-content>
</mat-sidenav-container>

