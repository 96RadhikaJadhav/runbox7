<div class="mainTextContent" *ngIf="!contact">
    Select a contact to view or edit its details
</div>

<div class="mainTextContent" *ngIf="contact">
    <h2>
        <mat-icon> {{ contactIcon }} </mat-icon>
        <span *ngIf="contact.display_name(); else defaultName">
            {{ contact.display_name() }}
        </span>
        <ng-template #defaultName>
            <span [ngSwitch]="contact.kind">
                <span *ngSwitchCase="kind.GROUP"> New group   </span>
                <span *ngSwitchDefault>           New contact </span>
            </span>
        </ng-template>
        's details
    </h2>
    <form [formGroup]="contactForm">
        <h3> Basic information </h3>
        <div *ngIf="contact.kind !== kind.INVIDIDUAL">
            <mat-form-field>
                <input matInput formControlName="full_name" placeholder="Name">
            </mat-form-field>
        </div>
        <div *ngIf="contact.kind === kind.INVIDIDUAL">
            <div class="contact-details-row">
                <mat-form-field>
                    <input matInput formControlName="nickname" placeholder="Nickname">
                </mat-form-field>
                <mat-form-field>
                    <input matInput formControlName="first_name" placeholder="First name">
                </mat-form-field>
                <mat-form-field>
                    <input matInput formControlName="last_name" placeholder="Last Name">
                </mat-form-field>
                <mat-form-field *ngIf="newCategoryPromptShown">
                    <input matInput #newCategoryInput placeholder="New category"
                          [(ngModel)]="newCategoryValue" [ngModelOptions]="{standalone: true}">
                    <!-- <mat-hint align="start"> Press Enter to confirm </mat-hint> -->
                    <button matSuffix mat-icon-button (click)="newCategoryPromptShown = false">
                        <mat-icon>cancel</mat-icon>
                    </button>
                    <button matSuffix mat-icon-button (click)="confirmNewCategory()">
                        <mat-icon>check</mat-icon>
                    </button>
                </mat-form-field>
                <mat-form-field *ngIf="!newCategoryPromptShown">
                    <mat-label> Categories </mat-label>
                    <mat-select formControlName="categories" placeholder="No categories" multiple>
                        <mat-select-trigger>
                            <span *ngIf="contactForm.get('categories').value; else no_categories">
                                {{ contactForm.get('categories').value }}
                            </span>
                            <ng-template #no_categories>
                                No categories
                            </ng-template>
                        </mat-select-trigger>
                        <mat-option *ngFor="let category of categories" [value]="category"> {{ category }} </mat-option>
                        <mat-option (click)="showNewCategoryPrompt()"> Add a new category... </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <div class="contact-details-row">
                <mat-form-field>
                    <input matInput formControlName="company" placeholder="Company">
                </mat-form-field>
                <mat-form-field>
                    <input matInput formControlName="department" placeholder="Department">
                </mat-form-field>
            </div>
            <div class="contact-details-row">
                <mat-form-field>
                    <input matInput formControlName="birthday" placeholder="Birthday">
                </mat-form-field>
            </div>
        </div>
        <div class="contact-details-row">
            <textarea matInput formControlName="note" placeholder="Notes"> </textarea>
        </div>

        <div *ngIf="contact.kind === kind.GROUP">
            <h3> Members </h3>
            <div *ngFor="let member of groupMembers">
                <div *ngIf="member | async as member">
                    <div *ngIf="member instanceof Contact; else not_contact">
                        <button mat-button routerLink="/contacts/{{ member.id }}" matTooltip="View details">
                            <app-contact-button [contact]="member"></app-contact-button>
                        </button>
                    </div>
                    <ng-template #not_contact>
                        {{ member.value }}
                    </ng-template>
                </div>
            </div>
        </div>

        <app-contact-details-fa-viewer
            title="Email addresses"
            [hidden]="false"

            [inputFG]="contactForm"
            faName="emails"
            (newElementClicked)="newEmail()"
            layout="simple"

            valuePlaceholder="E-mail address"
            deleteDescription="Delete this address"
            addNewDescription="Add a new e-mail address"

            actionIcon="email"
            actionDescription="Send an email to this address"
        >
        </app-contact-details-fa-viewer>

        <app-contact-details-fa-viewer
            title="Phone numbers"

            [inputFG]="contactForm"
            faName="phones"
            (newElementClicked)="newPhone()"
            layout="simple"

            valuePlaceholder="Phone number"
            deleteDescription="Delete this phone number"
            addNewDescription="Add a new phone number"
        >
        </app-contact-details-fa-viewer>

        <app-contact-details-fa-viewer
            title="Websites"

            [inputFG]="contactForm"
            faName="urls"
            (newElementClicked)="newUrl()"
            layout="simple"

            valuePlaceholder="Website address"
            deleteDescription="Delete this address"
            addNewDescription="Add a new address"

            actionIcon="link"
            actionDescription="Visit this website"
        >
        </app-contact-details-fa-viewer>

        <app-contact-details-fa-viewer
            title="Addresses"

            [inputFG]="contactForm"
            faName="addresses"
            (newElementClicked)="newAdr()"
            layout="complex"

            deleteDescription="Delete this address"
            addNewDescription="Add a new address"
        >
        </app-contact-details-fa-viewer>

        <app-contact-details-fa-viewer
            title="Relatives"

            [inputFG]="contactForm"
            faName="related"
            (newElementClicked)="newRelative()"
            layout="simple"

            valuePlaceholder="Name"
            deleteDescription="Delete this relative"
            addNewDescription="Add a new relative"
        >
        </app-contact-details-fa-viewer>

        <mat-toolbar style="position: fixed; bottom: 0;">
            <a mat-button (click)="save()">Save changes</a>
            <a mat-button (click)="rollback()" *ngIf="contact.id">Discard changes</a>
            <a mat-button (click)="delete()" *ngIf="contact.id">Delete this contact</a>
        </mat-toolbar>
    </form>
</div>
